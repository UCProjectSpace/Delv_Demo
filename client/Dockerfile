FROM node:18-alpine as builder
ARG REACT_APP_CONTRACT_ADDRESS
ARG REACT_APP_BASEURL
ARG REACT_APP_BUYER_ADDRESS
ARG REACT_APP_SELLER_ADDRESS
ARG REACT_APP_DISTRIBUTOR_ADDRESS
ARG REACT_APP_API_BASE_URL
ARG REACT_APP_DOMAIN
ENV REACT_APP_CONTRACT_ADDRESS=$REACT_APP_CONTRACT_ADDRESS
ENV REACT_APP_API_BASE_URL=$REACT_APP_API_BASE_URL
ENV REACT_APP_DOMAIN=$REACT_APP_DOMAIN
ENV REACT_APP_BASEURL=$REACT_APP_BASEURL
ENV REACT_APP_BUYER_ADDRESS=$REACT_APP_BUYER_ADDRESS
ENV REACT_APP_SELLER_ADDRESS=$REACT_APP_SELLER_ADDRESS
ENV REACT_APP_DISTRIBUTOR_ADDRESS=$REACT_APP_DISTRIBUTOR_ADDRESS
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine AS server
COPY ./nginx.conf /etc/nginx/templates/default.conf.template
COPY --from=builder ./app/build /usr/share/nginx/html